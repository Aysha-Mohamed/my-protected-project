<!DOCTYPE html>
<html>
<head>
  <title>Trigger Protected Commit</title>
</head>
<body>
  <h2>Protected Commit Trigger</h2>
  <form id="triggerForm">
    <label for="token">Auth Token:</label><br />
    <input type="password" id="token" name="token" required /><br /><br />

    <label for="fileContent">File Content:</label><br />
    <textarea id="fileContent" name="fileContent" rows="4" cols="40" required></textarea><br /><br />

    <label for="fileName">File Name (optional):</label><br />
    <input type="text" id="fileName" name="fileName" value="generated.txt" /><br /><br />

    <button type="submit">Trigger Workflow</button>
  </form>

  <p id="status"></p>

  <script>
    document.getElementById("triggerForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const token = document.getElementById("token").value;
      const fileContent = document.getElementById("fileContent").value;
      const fileName = document.getElementById("fileName").value;

      const repo = "Aysha-Mohamed/my-protected-project"; // <--- Change this to your repo
      const workflowFile = "protected-commit.yml";

      const response = await fetch(`https://api.github.com/repos/${repo}/actions/workflows/${workflowFile}/dispatches`, {
        method: "POST",
        headers: {
          "Accept": "application/vnd.github+json",
          "Authorization": `Bearer ${token}`, // GitHub personal access token
          "X-GitHub-Api-Version": "2022-11-28",
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          ref: "main",
          inputs: {
            authToken: token,
            fileContent,
            fileName
          }
        })
      });

      const status = document.getElementById("status");
      if (response.ok) {
        status.textContent = "✅ Workflow triggered!";
      } else {
        const err = await response.text();
        status.textContent = `❌ Failed: ${response.status} ${err}`;
      }
    });
  </script>
</body>
</html>
